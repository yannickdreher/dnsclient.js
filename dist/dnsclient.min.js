const{freeze:a}=Object;var b=a({0:'QUERY',1:'RESPONSE'}),c=a({0:'QUERY',1:'IQUERY',2:'STATUS',3:'RESERVED',4:'NOTIFY',5:'UPDATE',6:'DSO'}),d=a({0:'NOERROR',1:'FORMERR',2:'SERVFAIL',3:'NXDOMAIN',4:'NOTIMP',5:'REFUSED',6:'YXDOMAIN',7:'XRRSET',8:'NOTAUTH',9:'NOTZONE',10:'BADVERS',11:'BADSIG',12:'BADKEY',13:'BADTIME',14:'BADMODE',15:'BADNAME',16:'BADALG',17:'BADTRUNC',18:'BADCOOKIE'}),e=a({1:'A',2:'NS',3:'MD',4:'MF',5:'CNAME',6:'SOA',7:'MB',8:'MG',9:'MR',10:'NULL',11:'WKS',12:'PTR',13:'HINFO',14:'MINFO',15:'MX',16:'TXT',17:'RP',18:'AFSDB',19:'X25',20:'ISDN',21:'RT',22:'NSAP',23:'NSAP_PTR',24:'SIG',25:'KEY',26:'PX',27:'GPOS',28:'AAAA',29:'LOC',30:'NXT',31:'EID',32:'NIMLOC',33:'SRV',34:'ATMA',35:'NAPTR',36:'KX',37:'CERT',38:'A6',39:'DNAME',40:'SINK',41:'OPT',42:'APL',43:'DS',44:'SSHFP',45:'IPSECKEY',46:'RRSIG',47:'NSEC',48:'DNSKEY',49:'DHCID',50:'NSEC3',51:'NSEC3PARAM',52:'TLSA',53:'SMIMEA',55:'HIP',56:'NINFO',57:'RKEY',58:'TALINK',59:'CDS',60:'CDNSKEY',61:'OPENPGPKEY',62:'CSYNC',63:'ZONEMD',64:'SVCB',65:'HTTPS',99:'SPF',100:'UINFO',101:'UID',102:'GID',103:'UNSPEC',104:'NID',105:'L32',106:'L64',107:'LP',108:'EUI48',109:'EUI64',249:'TKEY',250:'TSIG',251:'IXFR',252:'AXFR',253:'MAILB',254:'MAILA',255:'ANY',256:'URI',257:'CAA',258:'AVC',259:'DOA',260:'AMTRELAY',32768:'TA',32769:'DLV'}),f=a({1:'IN',2:'CS',3:'CH',4:'HS',254:'NONE',255:'ANY'}),CLAZZ=a({IN:1,CS:2,CH:3,HS:4,NONE:254,ANY:255});export var TYPE=a({A:1,NS:2,CNAME:5,SOA:6,MX:15,TXT:16,AAAA:28,SRV:33,RRSIG:46,NSEC:47,DNSKEY:48,ANY:255});export class Question{constructor(A,_,B){this.name=A;this.type=_;this.clazz=B}}function j(C){return Buffer.from(C).toString('base64')}function k(_a){var _b=b[(_a>>15)&1],_c=c[(_a>>11)&0xF],D=(_a>>10)&1,E=(_a>>9)&1,F=(_a>>8)&1,g=(_a>>7)&1,h=d[_a&0xF];return{qr:_b,opcode:_c,aa:D,tc:E,rd:F,ra:g,rcode:h}}function l(_A){var _B=new DataView(_A);var _C=_B.getUint16(0),_d=k(_B.getUint16(2)),_e=_B.getUint16(4),_f=_B.getUint16(6),G=_B.getUint16(8),H=_B.getUint16(10),J=[];let I=12;for(let i=0;i<_e;i++){const aX=n(_B,I),aZ=f[_B.getUint16(I+2)];I=aX.offset;const aY=e[_B.getUint16(I)];I+=4;J.push({name:aX.name,type:aY,clazz:aZ})}var K=[];for(let i=0;i<_f;i++){const bA=n(_B,I),bC=f[_B.getUint16(I+2)],_D=_B.getUint32(I+4),_E=_B.getUint16(I+8);I=bA.offset;const bB=e[_B.getUint16(I)];I+=10;let _F=[{key:'',value:''}];if(bB==='A'){if(_E!==4)throw Error('Invalid IPv4 byte array length.');var L=new Uint8Array(_B.buffer.slice(I,I+_E)).join('.');I+=_E;_F=[{key:'ipv4',value:L}]}else if(bB==='NS'||bB==='CNAME'){var M=n(_B,I);I=M.offset;_F=[{key:'name',value:M.name}]}else if(bB==='SOA'){var N=n(_B,I),p=_B.getUint32(I+0),q=_B.getUint32(I+4),r=_B.getUint32(I+8),s=_B.getUint32(I+12),t=_B.getUint32(I+16);I=N.offset;var O=n(_B,I);I=O.offset;I+=20;_F=[{key:'mname',value:N.name},{key:'rname',value:O.name},{key:'serial',value:p},{key:'refresh',value:q},{key:'retry',value:r},{key:'expire',value:s},{key:'minimum',value:t}]}else if(bB==='MX'){var u=_B.getUint16(I);I+=2;var v=n(_B,I);I=v.offset;_F=[{key:'preference',value:u},{key:'exchange',value:v.name}]}else if(bB==='AAAA'){if(_E!==16)throw Error('Invalid IPv6 byte array length.');var w=new Uint8Array(_B.buffer.slice(I,I+_E));I+=_E;var x=[];for(let i=0;i<16;i+=2){const bD=(w[i]<<8)|w[i+1];x.push(bD.toString(16))}var y=x.join(':').replace(/(^|:)0(:0)*(:|$)/,'$1::$3').replace(/:{3,4}/,'::');_F=[{key:'ipv6',value:y}]}else if(bB==='SRV'){var z=_B.getUint16(I+0),aA=_B.getUint16(I+2),aB=_B.getUint16(I+4),aC=n(_B,I+6);I+=_E;_F=[{key:'priority',value:z},{key:'weight',value:aA},{key:'port',value:aB},{key:'target',value:aC.name}]}else if(bB==='TXT'){var aD=_B.getUint8(I),aE=new TextDecoder().decode(_B.buffer.slice(I+1,I+1+aD));I+=_E;_F=[{key:'text',value:aE}]}else if(bB==='RRSIG'){var aF=e[_B.getUint16(I)],aG=_B.getUint8(I+2),aH=_B.getUint8(I+3),aI=_B.getUint32(I+4),aJ=_B.getUint32(I+8),aK=_B.getUint32(I+12),aL=_B.getUint16(I+16),aM=n(_B,I+18),aN=_B.buffer.slice(aM.offset,aM.offset+_E),aO=btoa(String.fromCharCode(...new Uint8Array(aN)));I+=_E;_F=[{key:'typeCovered',value:aF},{key:'algorithm',value:aG},{key:'labels',value:aH},{key:'originalTtl',value:aI},{key:'expiration',value:new Date(aJ*1000)},{key:'inception',value:new Date(aK*1000)},{key:'keyTag',value:aL},{key:'signersName',value:aM.name},{key:'signature',value:aO}]}else if(bB==='NSEC'){var aP=n(_B,I),aR=[];I+=aP.length;var aQ=I+_E-aP.length;while (I<aQ) {var aS=_B.getUint8(I++),aT=_B.getUint8(I++);for(let i=0;i<aT;i++){const bE=_B.getUint8(I++);for(let bit=0;bit<8;bit++)if(bE&(1<<(7-bit))){var aU=(aS*256)+(i*8)+bit;aR.push(e[aU])}}}_F=[{key:'nextDomain',value:aP.name},{key:'typeBitmaps',value:aR}]}else if(bB==='DNSKEY'){let bF=_B.getUint16(I);switch(bF) {case 256:bF='ZSK';break;case 257:bF='KSK';break;default:bF='unknown'}var aV=_B.getUint8(I+2),bG=_B.getUint8(I+3),aW=j(_B.buffer.slice(I+4,I+68));I+=_E;_F=[{key:'flag',value:bF},{key:'protocol',value:aV},{key:'algorithm',value:bG},{key:'publickey',value:aW}]}else{I+=_E;_F=[{key:'info',value:'this RR type is not yet taken into account by dnsclient.js.'}]}K.push({name:bA.name,type:bB,clazz:bC,ttl:_D,data:_F})}return{transactionID:_C,flags:_d,qdcount:_e,ancount:_f,arcount:G,adcount:H,questions:J,answers:K}}function m(bH){var bI=crypto.getRandomValues(new Uint8Array(2)),bL=bH.name.split('.').map(bN=>{const bO=Array(bN.length+1);bO[0]=bN.length;for(let i=0;i<bN.length;i++)bO[i+1]=bN.charCodeAt(i);return bO}).flat(Infinity).concat([0]);var bJ=new Uint8Array([0x01,0x00]);var bK=new Uint8Array([0x00,0x01]);var bM=new Uint8Array([0x00,bH.type]);var _g=new Uint8Array([0x00,bH.clazz]);return Uint8Array.from([...bI,...bJ,...bK,0x00,0x00,0x00,0x00,0x00,0x00,...bL,...bM,..._g])}function n(bP,bQ){let bR=[];let bS=bP.getUint8(bQ);let bT=!1;let bU=0;let _G=bQ;while (bS!==0)if((bS&0xc0)===0xc0){!bT&&(bU=bQ+2);bQ=((bS&0x3f)<<8)|bP.getUint8(bQ+1);bS=bP.getUint8(bQ);bT=!0}else{bQ++;bR.push(new TextDecoder().decode(bP.buffer.slice(bQ,bQ+bS)));bQ+=bS;bS=bP.getUint8(bQ)}!bT&&(bU=bQ+1);return{name:bR.join('.'),offset:bU,length:bU-_G}}async function o(bV,bW){let bX='';const bY=m(bW),bZ=performance.now(),cB=performance.now();var cA=await fetch(bV,{method:'POST',headers:{'Content-Type':'application/dns-message'},body:bY});if(!cA.ok)throw Error(`DNS query request failed with status code: ${cA.status}`);else{var _h=await cA.arrayBuffer();bX=l(_h)}var _i=Math.round(cB-bZ);return{message:bX,latency:_i}}export{o as query};
