const{freeze:a}=Object;var b=a({0:'QUERY',1:'RESPONSE'}),c=a({0:'QUERY',1:'IQUERY',2:'STATUS',3:'RESERVED',4:'NOTIFY',5:'UPDATE',6:'DSO'}),d=a({0:'NOERROR',1:'FORMERR',2:'SERVFAIL',3:'NXDOMAIN',4:'NOTIMP',5:'REFUSED',6:'YXDOMAIN',7:'XRRSET',8:'NOTAUTH',9:'NOTZONE',10:'BADVERS',11:'BADSIG',12:'BADKEY',13:'BADTIME',14:'BADMODE',15:'BADNAME',16:'BADALG',17:'BADTRUNC',18:'BADCOOKIE'}),e=a({1:'A',2:'NS',3:'MD',4:'MF',5:'CNAME',6:'SOA',7:'MB',8:'MG',9:'MR',10:'NULL',11:'WKS',12:'PTR',13:'HINFO',14:'MINFO',15:'MX',16:'TXT',17:'RP',18:'AFSDB',19:'X25',20:'ISDN',21:'RT',22:'NSAP',23:'NSAP_PTR',24:'SIG',25:'KEY',26:'PX',27:'GPOS',28:'AAAA',29:'LOC',30:'NXT',31:'EID',32:'NIMLOC',33:'SRV',34:'ATMA',35:'NAPTR',36:'KX',37:'CERT',38:'A6',39:'DNAME',40:'SINK',41:'OPT',42:'APL',43:'DS',44:'SSHFP',45:'IPSECKEY',46:'RRSIG',47:'NSEC',48:'DNSKEY',49:'DHCID',50:'NSEC3',51:'NSEC3PARAM',52:'TLSA',53:'SMIMEA',55:'HIP',56:'NINFO',57:'RKEY',58:'TALINK',59:'CDS',60:'CDNSKEY',61:'OPENPGPKEY',62:'CSYNC',63:'ZONEMD',64:'SVCB',65:'HTTPS',99:'SPF',100:'UINFO',101:'UID',102:'GID',103:'UNSPEC',104:'NID',105:'L32',106:'L64',107:'LP',108:'EUI48',109:'EUI64',249:'TKEY',250:'TSIG',251:'IXFR',252:'AXFR',253:'MAILB',254:'MAILA',255:'ANY',256:'URI',257:'CAA',258:'AVC',259:'DOA',260:'AMTRELAY',32768:'TA',32769:'DLV'}),f=a({1:'IN',2:'CS',3:'CH',4:'HS',254:'NONE',255:'ANY'}),CLAZZ=a({IN:1,CS:2,CH:3,HS:4,NONE:254,ANY:255});export var TYPE=a({A:1,NS:2,CNAME:5,SOA:6,MX:15,TXT:16,AAAA:28,SRV:33,RRSIG:46,NSEC:47,DNSKEY:48,ANY:255});export class Question{constructor(A,_,B){this.name=A;this.type=_;this.clazz=B}}function j(C){return Buffer.from(C).toString('base64')}function k(_a){var _b=b[(_a>>15)&1],_c=c[(_a>>11)&0xF],D=(_a>>10)&1,E=(_a>>9)&1,F=(_a>>8)&1,g=(_a>>7)&1,h=d[_a&0xF];return{qr:_b,opcode:_c,aa:D,tc:E,rd:F,ra:g,rcode:h}}function l(_A,_B,_C){if(_C!==4)throw Error('Invalid IPv4 byte array length.');var _d=new Uint8Array(_A.buffer.slice(_B,_B+_C)).join('.');return[{key:'ipv4',value:_d}]}function m(aA,aB){var aC=y(aA,aB);return[{key:'name',value:aC.name}]}function n(aD,aE){var aF=y(aD,aE);return[{key:'name',value:aF.name}]}function o(aG,aH){var aI=y(aG,aH),_e=aG.getUint32(aH+0),_f=aG.getUint32(aH+4),G=aG.getUint32(aH+8),H=aG.getUint32(aH+12),I=aG.getUint32(aH+16),J=[{key:'mname',value:aI.name},{key:'rname',value:_D.name},{key:'serial',value:_e},{key:'refresh',value:_f},{key:'retry',value:G},{key:'expire',value:H},{key:'minimum',value:I}];aH=aI.offset;var _D=y(aG,aH);aH=_D.offset;return J}function p(aJ,aK){var aL=aJ.getUint16(aK),aM=y(aJ,aK+2),_E=[{key:'preference',value:aL},{key:'exchange',value:aM.name}];return _E}function q(aN,aO,aP){if(aP!==16)throw Error('Invalid IPv6 byte array length.');var aQ=new Uint8Array(aN.buffer.slice(aO,aO+aP));var aR=[];for(let i=0;i<16;i+=2){const aS=(aQ[i]<<8)|aQ[i+1];aR.push(aS.toString(16))}var _F=aR.join(':').replace(/(^|:)0(:0)*(:|$)/,'$1::$3').replace(/:{3,4}/,'::');return[{key:'ipv6',value:_F}]}function r(aT,aU){var aV=aT.getUint16(aU+0),aW=aT.getUint16(aU+2),aX=aT.getUint16(aU+4),aY=y(aT,aU+6),_g=[{key:'priority',value:aV},{key:'weight',value:aW},{key:'port',value:aX},{key:'target',value:aY.name}];return _g}function s(aZ,bA){var bB=aZ.getUint8(bA),bC=new TextDecoder().decode(aZ.buffer.slice(bA+1,bA+1+bB));return[{key:'text',value:bC}]}function t(bD,bE,bF){var bG=e[bD.getUint16(bE)],bH=bD.getUint8(bE+2),bI=bD.getUint8(bE+3),_G=bD.getUint32(bE+4),_h=bD.getUint32(bE+8),_i=bD.getUint32(bE+12),_j=bD.getUint16(bE+16),K=y(bD,bE+18),L=bD.buffer.slice(K.offset,K.offset+bF),M=btoa(String.fromCharCode(...new Uint8Array(L))),N=[{key:'typeCovered',value:bG},{key:'algorithm',value:bH},{key:'labels',value:bI},{key:'originalTtl',value:_G},{key:'expiration',value:new Date(_h*1000)},{key:'inception',value:new Date(_i*1000)},{key:'keyTag',value:_j},{key:'signersName',value:K.name},{key:'signature',value:M}];return N}function u(bJ,bK,bL){var bM=y(bJ,bK),bO=[];bK+=bM.length;var bN=bK+bL-bM.length;while (bK<bN) {var bP=bJ.getUint8(bK++),_H=bJ.getUint8(bK++);for(let i=0;i<_H;i++){const bQ=bJ.getUint8(bK++);for(let bit=0;bit<8;bit++)if(bQ&(1<<(7-bit))){var _I=(bP*256)+(i*8)+bit;bO.push(e[_I])}}}var _J=[{key:'nextDomain',value:bM.name},{key:'typeBitmaps',value:bO}];return _J}function v(bR,bS){let bT=bR.getUint16(bS);switch(bT) {case 256:bT='ZSK';break;case 257:bT='KSK';break;default:bT='unknown'}var bU=bR.getUint8(bS+2),bV=bR.getUint8(bS+3),bW=j(bR.buffer.slice(bS+4,bS+68)),bX=[{key:'flag',value:bT},{key:'protocol',value:bU},{key:'algorithm',value:bV},{key:'publickey',value:bW}];return bX}function w(bY){var bZ=new DataView(bY);var cA=bZ.getUint16(0),cB=k(bZ.getUint16(2)),cC=bZ.getUint16(4),cD=bZ.getUint16(6),cE=bZ.getUint16(8),cF=bZ.getUint16(10),cH=[];let cG=12;for(let i=0;i<cC;i++){const cI=y(bZ,cG),cK=f[bZ.getUint16(cG+2)];cG=cI.offset;const cJ=e[bZ.getUint16(cG)];cG+=4;cH.push({name:cI.name,type:cJ,clazz:cK})}var _k=[];for(let i=0;i<cD;i++){const cL=y(bZ,cG),cN=f[bZ.getUint16(cG+2)],cO=bZ.getUint32(cG+4),cP=bZ.getUint16(cG+8);cG=cL.offset;const cM=e[bZ.getUint16(cG)];cG+=10;let cQ=[{key:'',value:''}];switch(cM) {case 'A':cQ=l(bZ,cG,cP);break;case 'NS':cQ=m(bZ,cG);break;case 'CNAME':cQ=n(bZ,cG);break;case 'SOA':cQ=o(bZ,cG);break;case 'MX':cQ=p(bZ,cG);break;case 'AAAA':cQ=q(bZ,cG,cP);break;case 'SRV':cQ=r(bZ,cG);break;case 'TXT':cQ=s(bZ,cG);break;case 'RRSIG':cQ=t(bZ,cG,cP);break;case 'NSEC':cQ=u(bZ,cG,cP);break;case 'DNSKEY':cQ=v(bZ,cG);break;default:cQ=[{key:'info',value:'this RR type is not yet taken into account by dnsclient.js.'}]}cG+=cP;_k.push({name:cL.name,type:cM,clazz:cN,ttl:cO,data:cQ})}return{transactionID:cA,flags:cB,qdcount:cC,ancount:cD,arcount:cE,adcount:cF,questions:cH,answers:_k}}function x(cR){var cS=crypto.getRandomValues(new Uint8Array(2)),cV=cR.name.split('.').map(cY=>{const cZ=Array(cY.length+1);cZ[0]=cY.length;for(let i=0;i<cY.length;i++)cZ[i+1]=cY.charCodeAt(i);return cZ}).flat(Infinity).concat([0]);var cT=new Uint8Array([0x01,0x00]);var cU=new Uint8Array([0x00,0x01]);var cW=new Uint8Array([0x00,cR.type]);var cX=new Uint8Array([0x00,cR.clazz]);return Uint8Array.from([...cS,...cT,...cU,0x00,0x00,0x00,0x00,0x00,0x00,...cV,...cW,...cX])}function y(dA,dB){let dC=[];let dD=dA.getUint8(dB);let dE=!1;let dF=0;let dG=dB;while (dD!==0)if((dD&0xc0)===0xc0){!dE&&(dF=dB+2);dB=((dD&0x3f)<<8)|dA.getUint8(dB+1);dD=dA.getUint8(dB);dE=!0}else{dB++;dC.push(new TextDecoder().decode(dA.buffer.slice(dB,dB+dD)));dB+=dD;dD=dA.getUint8(dB)}!dE&&(dF=dB+1);return{name:dC.join('.'),offset:dF,length:dF-dG}}async function z(dH,dI){let dJ='';const dK=x(dI),dL=performance.now(),dN=performance.now();var dM=await fetch(dH,{method:'POST',headers:{'Content-Type':'application/dns-message'},body:dK});if(!dM.ok)throw Error(`DNS query request failed with status code: ${dM.status}`);else{var dO=await dM.arrayBuffer();dJ=w(dO)}var dP=Math.round(dN-dL);return{message:dJ,latency:dP}}export{z as query};
