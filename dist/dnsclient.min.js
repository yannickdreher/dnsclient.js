const{freeze:a}=Object;var A=a({0:'QUERY',1:'RESPONSE'}),c=a({0:'QUERY',1:'IQUERY',2:'STATUS',3:'RESERVED',4:'NOTIFY',5:'UPDATE',6:'DSO'}),d=a({0:'NOERROR',1:'FORMERR',2:'SERVFAIL',3:'NXDOMAIN',4:'NOTIMP',5:'REFUSED',6:'YXDOMAIN',7:'XRRSET',8:'NOTAUTH',9:'NOTZONE',10:'BADVERS',11:'BADSIG',12:'BADKEY',13:'BADTIME',14:'BADMODE',15:'BADNAME',16:'BADALG',17:'BADTRUNC',18:'BADCOOKIE'}),e=a({1:'A',2:'NS',3:'MD',4:'MF',5:'CNAME',6:'SOA',7:'MB',8:'MG',9:'MR',10:'NULL',11:'WKS',12:'PTR',13:'HINFO',14:'MINFO',15:'MX',16:'TXT',17:'RP',18:'AFSDB',19:'X25',20:'ISDN',21:'RT',22:'NSAP',23:'NSAP_PTR',24:'SIG',25:'KEY',26:'PX',27:'GPOS',28:'AAAA',29:'LOC',30:'NXT',31:'EID',32:'NIMLOC',33:'SRV',34:'ATMA',35:'NAPTR',36:'KX',37:'CERT',38:'A6',39:'DNAME',40:'SINK',41:'OPT',42:'APL',43:'DS',44:'SSHFP',45:'IPSECKEY',46:'RRSIG',47:'NSEC',48:'DNSKEY',49:'DHCID',50:'NSEC3',51:'NSEC3PARAM',52:'TLSA',53:'SMIMEA',55:'HIP',56:'NINFO',57:'RKEY',58:'TALINK',59:'CDS',60:'CDNSKEY',61:'OPENPGPKEY',62:'CSYNC',63:'ZONEMD',64:'SVCB',65:'HTTPS',99:'SPF',100:'UINFO',101:'UID',102:'GID',103:'UNSPEC',104:'NID',105:'L32',106:'L64',107:'LP',108:'EUI48',109:'EUI64',249:'TKEY',250:'TSIG',251:'IXFR',252:'AXFR',253:'MAILB',254:'MAILA',255:'ANY',256:'URI',257:'CAA',258:'AVC',259:'DOA',260:'AMTRELAY',32768:'TA',32769:'DLV'}),f=a({1:'IN',2:'CS',3:'CH',4:'HS',254:'NONE',255:'ANY'}),CLAZZ=a({IN:1,CS:2,CH:3,HS:4,NONE:254,ANY:255});export var TYPE=a({A:1,NS:2,CNAME:5,SOA:6,MX:15,TXT:16,AAAA:28,SRV:33,DS:43,RRSIG:46,NSEC:47,DNSKEY:48,CDS:59,CDNSKEY:60,ANY:255});export class Question{constructor(B,C,_c){this.name=B;this.type=C;this.clazz=_c}}function j(_a){return Buffer.from(_a).toString('base64')}function k(D){var _b=A[(D>>15)&1],_C=c[(D>>11)&0xF],_d=(D>>10)&1,E=(D>>9)&1,F=(D>>8)&1,g=(D>>7)&1,h=d[D&0xF];return{qr:_b,opcode:_C,aa:_d,tc:E,rd:F,ra:g,rcode:h}}function l(_A,_B,aA){if(aA!==4)throw Error('Invalid IPv4 byte array length.');var _D=new Uint8Array(_A.buffer.slice(_B,_B+aA)).join('.');return[{key:'ipv4',value:_D}]}function m(aB,aC){var aD=z(aB,aC);return[{key:'name',value:aD.name}]}function n(aE,aF){var aG=z(aE,aF);return[{key:'name',value:aG.name}]}function o(aH,aI){var aJ=z(aH,aI),_e=aH.getUint32(aI+0),_f=aH.getUint32(aI+4),G=aH.getUint32(aI+8),H=aH.getUint32(aI+12),I=aH.getUint32(aI+16),J=[{key:'mname',value:aJ.name},{key:'rname',value:aK.name},{key:'serial',value:_e},{key:'refresh',value:_f},{key:'retry',value:G},{key:'expire',value:H},{key:'minimum',value:I}];aI=aJ.offset;var aK=z(aH,aI);aI=aK.offset;return J}function p(aL,aM){var aN=aL.getUint16(aM),aO=z(aL,aM+2),_E=[{key:'preference',value:aN},{key:'exchange',value:aO.name}];return _E}function q(aP,aQ,aR){if(aR!==16)throw Error('Invalid IPv6 byte array length.');var aS=new Uint8Array(aP.buffer.slice(aQ,aQ+aR));var aT=[];for(let i=0;i<16;i+=2){const aU=(aS[i]<<8)|aS[i+1];aT.push(aU.toString(16))}var _F=aT.join(':').replace(/(^|:)0(:0)*(:|$)/,'$1::$3').replace(/:{3,4}/,'::');return[{key:'ipv6',value:_F}]}function r(aV,aW){var aX=aV.getUint16(aW+0),aY=aV.getUint16(aW+2),aZ=aV.getUint16(aW+4),bA=z(aV,aW+6),_g=[{key:'priority',value:aX},{key:'weight',value:aY},{key:'port',value:aZ},{key:'target',value:bA.name}];return _g}function s(bB,bC,bD){var bE=bB.getUint16(bC+0),bF=bB.getUint8(bC+2),bG=bB.getUint8(bC+3),_G=bB.buffer.slice(4,bC+bD),_h=new Uint8Array(_G).map(b=>b.toString(16).padStart(2,'0')).join(''),_i=[{key:'keyTag',value:bE},{key:'algorithm',value:bF},{key:'digestType',value:bG},{key:'digest',value:_h}];return _i}function t(bH,bI){var bJ=bH.getUint8(bI),bK=new TextDecoder().decode(bH.buffer.slice(bI+1,bI+1+bJ));return[{key:'text',value:bK}]}function u(bL,bM,bN){var bO=e[bL.getUint16(bM)],bP=bL.getUint8(bM+2),bQ=bL.getUint8(bM+3),bR=bL.getUint32(bM+4),_H=bL.getUint32(bM+8),_I=bL.getUint32(bM+12),_j=bL.getUint16(bM+16),K=z(bL,bM+18),L=bL.buffer.slice(K.offset,K.offset+bN),M=btoa(String.fromCharCode(...new Uint8Array(L))),N=[{key:'typeCovered',value:bO},{key:'algorithm',value:bP},{key:'labels',value:bQ},{key:'originalTtl',value:bR},{key:'expiration',value:new Date(_H*1000)},{key:'inception',value:new Date(_I*1000)},{key:'keyTag',value:_j},{key:'signersName',value:K.name},{key:'signature',value:M}];return N}function v(bS,bT,bU){var bV=z(bS,bT),bX=[];bT+=bV.length;var bW=bT+bU-bV.length;while (bT<bW) {var bY=bS.getUint8(bT++),bZ=bS.getUint8(bT++);for(let i=0;i<bZ;i++){const cB=bS.getUint8(bT++);for(let bit=0;bit<8;bit++)if(cB&(1<<(7-bit))){var cA=(bY*256)+(i*8)+bit;bX.push(e[cA])}}}var _J=[{key:'nextDomain',value:bV.name},{key:'typeBitmaps',value:bX}];return _J}function w(cC,cD){let cE=cC.getUint16(cD);switch(cE) {case 256:cE='ZSK';break;case 257:cE='KSK';break;default:cE='unknown'}var cF=cC.getUint8(cD+2),cG=cC.getUint8(cD+3),cH=j(cC.buffer.slice(cD+4,cD+68)),cI=[{key:'flag',value:cE},{key:'protocol',value:cF},{key:'algorithm',value:cG},{key:'publickey',value:cH}];return cI}function x(cJ){var cK=new DataView(cJ);var cL=cK.getUint16(0),cM=k(cK.getUint16(2)),cN=cK.getUint16(4),cO=cK.getUint16(6),cP=cK.getUint16(8),cQ=cK.getUint16(10),cS=[];let cR=12;for(let i=0;i<cN;i++){const cT=z(cK,cR),cV=f[cK.getUint16(cR+2)];cR=cT.offset;const cU=e[cK.getUint16(cR)];cR+=4;cS.push({name:cT.name,type:cU,clazz:cV})}var _k=[];for(let i=0;i<cO;i++){const cW=z(cK,cR),cY=f[cK.getUint16(cR+2)],cZ=cK.getUint32(cR+4),dA=cK.getUint16(cR+8);cR=cW.offset;const cX=e[cK.getUint16(cR)];cR+=10;let dB=[{key:'',value:''}];switch(cX) {case 'A':dB=l(cK,cR,dA);break;case 'NS':dB=m(cK,cR);break;case 'CNAME':dB=n(cK,cR);break;case 'SOA':dB=o(cK,cR);break;case 'MX':dB=p(cK,cR);break;case 'AAAA':dB=q(cK,cR,dA);break;case 'SRV':dB=r(cK,cR);break;case 'DS':dB=s(cK,cR,dA);break;case 'TXT':dB=t(cK,cR);break;case 'RRSIG':dB=u(cK,cR,dA);break;case 'NSEC':dB=v(cK,cR,dA);break;case 'DNSKEY':dB=w(cK,cR);break;case 'CDS':dB=s(cK,cR,dA);break;case 'CDNSKEY':dB=w(cK,cR);break;default:dB=[{key:'info',value:'this RR type is not yet taken into account by dnsclient.js.'}]}cR+=dA;_k.push({name:cW.name,type:cX,clazz:cY,ttl:cZ,data:dB})}return{transactionID:cL,flags:cM,qdcount:cN,ancount:cO,arcount:cP,adcount:cQ,questions:cS,answers:_k}}function y(dC){var dD=crypto.getRandomValues(new Uint8Array(2)),dG=dC.name.split('.').map(dJ=>{const dK=Array(dJ.length+1);dK[0]=dJ.length;for(let i=0;i<dJ.length;i++)dK[i+1]=dJ.charCodeAt(i);return dK}).flat(Infinity).concat([0]);var dE=new Uint8Array([0x01,0x00]);var dF=new Uint8Array([0x00,0x01]);var dH=new Uint8Array([0x00,dC.type]);var dI=new Uint8Array([0x00,dC.clazz]);return Uint8Array.from([...dD,...dE,...dF,0x00,0x00,0x00,0x00,0x00,0x00,...dG,...dH,...dI])}function z(dL,dM){let dN=[];let dO=dL.getUint8(dM);let dP=!1;let dQ=0;let dR=dM;while (dO!==0)if((dO&0xc0)===0xc0){!dP&&(dQ=dM+2);dM=((dO&0x3f)<<8)|dL.getUint8(dM+1);dO=dL.getUint8(dM);dP=!0}else{dM++;dN.push(new TextDecoder().decode(dL.buffer.slice(dM,dM+dO)));dM+=dO;dO=dL.getUint8(dM)}!dP&&(dQ=dM+1);return{name:dN.join('.'),offset:dQ,length:dQ-dR}}async function _(dS,dT){let dU='';const dV=y(dT),dW=performance.now(),dY=performance.now();var dX=await fetch(dS,{method:'POST',headers:{'Content-Type':'application/dns-message'},body:dV});if(!dX.ok)throw Error(`DNS query request failed with status code: ${dX.status}`);else{var dZ=await dX.arrayBuffer();dU=x(dZ)}var eA=Math.round(dY-dW);return{message:dU,latency:eA}}export{_ as query};
